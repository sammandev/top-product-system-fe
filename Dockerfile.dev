# Development Dockerfile with Hot Module Replacement (HMR)
# Source code is mounted as volume for instant updates

FROM node:22-alpine

# Set working directory
WORKDIR /app

# Install pnpm
RUN corepack enable && corepack prepare pnpm@latest --activate

# Expose Vite dev server port
EXPOSE 5173

# Health check for Vite dev server
HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD wget --quiet --tries=1 --spider http://localhost:5173/ || exit 1

# Copy package files for dependency installation
COPY package.json pnpm-lock.yaml ./

# Start Vite dev server with HMR
# Allow lock file updates in staging environment for flexibility
CMD ["sh", "-c", "pnpm install && pnpm run dev --host 0.0.0.0 --port 5173"]
